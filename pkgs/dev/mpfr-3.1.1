
source_pkg ".functions/build" "${repo}"

version=3.1.1
description="MPFR"
depends=('dev/gmp-5')
website="http://www.mpfr.org"
license=('LGPL')
forceinstall=('usr/share/info/dir')

isinstalled() {
	local headerpath
	local old_IFS="$IFS"
	IFS=":"

	# Check all the common paths
	for path in ${CPATH[@]} /include /usr/include; do
		if [[ -f "$path/mpfr.h" ]]; then
			headerpath="$path/mpfr.h"
			break
		fi
	done
	IFS="$old_IFS"

	if [[ -z "$headerpath" ]]; then
		return 1
	else
		grep -q "MPFR_VERSION_STRING \"${version}\"$" "$headerpath"
	fi
}

iscompat() {
	return 0
}

build() {
	fetch_extract \
		"http://www.mpfr.org/mpfr-${version}/mpfr-${version}.tar.bz2" \
		"7b66c3f13dc8385f08264c805853f3e1a8eedab8071d582f3e661971c9acd5fd"

	cd "mpfr-${version}"

	fetch \
		"$repo/../support/patches/dev/mpfr-3.1.1-allpatches.patch" \
		"1aeefe799d29bafde1ab6c889a8a0adb6597fec6bc10be761dc4e366bcecbec5"

	patch -Np1 -i mpfr-3.1.1-allpatches.patch

	build_wrap_ldflags ./configure --prefix="${prefix}/usr" --enable-thread-safe --enable-shared
	make
}

installenv() {
	cd "mpfr-${version}"
	make DESTDIR="${destdir}" install
}

# vim: set ft=sh :
