# Based on: https://projects.archlinux.org/svntogit/packages.git/tree/trunk/PKGBUILD?h=packages/python

version=3.3.0
description="The Python 3 interpreter"
depends=("dev/gdbm")
website="http://www.python.org"
license=('PSF')

_pybasever="${version%.*}"

isinstalled() {
	python3 --version 2>&1 | grep -q "$version" &> /dev/null
}

iscompat() {
	return 0
}

build() {
	fetch_extract \
		"http://www.python.org/ftp/python/${version}/Python-${version}.tar.bz2" \
		"15c113fd6c058712f05d31b4eff149d4d823b8e39ef5e37228dc5dc4f8716df9"

	cd "Python-${version}"

	LDFLAGS="-Wl,-rpath=$LD_RUN_PATH" ./configure --prefix="$1" \
		--enable-shared \
		--with-threads \
		--with-computed-gotos \
		--enable-ipv6 \
		--with-valgrind \
		--with-system-expat \
		--with-dbmliborder=gdbm:ndbm \
		--with-system-ffi
	
	make
}

installenv() {
	cd "Python-${version}"
	make DESTDIR="$2" install maninstall

	ln -sf python3               "${pkgdir}/usr/bin/python"
	ln -sf python3-config        "${pkgdir}/usr/bin/python-config"
	ln -sf idle3                 "${pkgdir}/usr/bin/idle"
	ln -sf pydoc3                "${pkgdir}/usr/bin/pydoc"
	ln -sf python${_pybasever}.1 "${pkgdir}/usr/share/man/man1/python3.1"

	ln -sf ../../libpython${_pybasever}m.so \
		"$2/$1/lib/python${_pybasever}/config-${_pybasever}m/libpython${_pybasever}m.so"
}

# vim: set ft=sh :
